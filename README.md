# bilibilitv1.6.6-repair
> ！！！⚠警告：bilibili已于2025年1月9日修改大会员协议，**同一账号同一时间最多可在2个终端设备使用会员服务**，本软件大会员相关模块未经测试，请谨慎使用！！！

还是bilibilitv1.6.6的界面舒服，缝缝补补继续用



## 免责声明？

> 不得利用本项目进行任何非法活动。
> 不得干扰B站的正常运营。
> 不得传播恶意软件或病毒。
> 此外，为降低法律风险

1. 🚫禁止在官方平台（b站）及官方账号区域（如b站微博评论区）宣传本项目
2. 🚫禁止在微信公众号平台宣传本项目
3. 🚫禁止利用本项目牟利，本项目无任何盈利行为，第三方盈利与本项目无关

后续将对以上行为进行自动化取证、封禁、举报。

#### 小黑屋（警告名单）

| 平台       | 用户名                                    | 用户ID                      | 标价（原价） | 浏览量/销量 |
| ---------- | ----------------------------------------- | --------------------------- | ------------ | ----------- |
| 微信公众号 | 分享迷                                    | sharerw(gh_dd0004361f38)    |              |             |
| 微信公众号 | 花生疾风                                  | huashengjf(gh_0dbabb7ce936) |              |             |
| 微信公众号 | 黑科技风向标                              | gh_4f387432580c             |              |             |
| 微信公众号 | 盒子迷                                    | TVBOXTVBOX(gh_406f0735535b) |              |             |
| 闲鱼       | [奔跑的蜗牛](小黑屋/闲鱼831447083176.png) | 2218504362380               | ¥3           | 100+        |
| 闲鱼       | [橙风工作室](小黑屋/闲鱼917146633448.png) | 2219743046071               | ¥1(¥5)       | 10+         |
| 闲鱼       | [RobinLi](小黑屋/闲鱼913231063401.png)    | 2001138670                  | ¥5           | 10+         |
| 闲鱼       | [因陀罗轻创](小黑屋/闲鱼877626193496.png) | 3991470970                  | ¥1.88        | 100+        |




## 相关链接

- 常见故障排查：[#83](https://github.com/qidian55/bilibilitv1.6.6-repair/discussions/83)
- 使用指南：[wiki](https://github.com/qidian55/bilibilitv1.6.6-repair/wiki)

## 版本

### v1.0
> 参考手撕签名版和改版4先缝合一个能用的版本。

- 由于原版似乎有签名校验，动态链接库采用手撕签名版的libbili.so
- 视频源采用改版4的TV源（官方TV版有的视频才有高清视频源）

### v2.0
> 似乎很多人想要首页推荐，尝试把1.6.4的首页和剧集推荐缝进来

- 首页推荐和剧集推荐改用1.6.4版本的接口和代码
- 剧集源回退至原版

### v3.0
> 尝试换用[bilibili-API-collect](https://github.com/SocialSisterYi/bilibili-API-collect)提供的web源

- 强制采用web视频及剧集源，登录后可获取1080P视频

### v4.0
> 微调

- 修复原版uid过长导致的动态加载失败问题
- 由于原版推荐接口恢复正常，回退相关代码
- 视频及剧集均优先采用TV源，次优采用web源（B站接口变换过于频繁，先尽可能找个清晰度比较高的凑合着用）

### v5.0
> 尝试基于java层修复

- 用捉急的Java代码水平重写了直播源获取相关逻辑，锁定原画画质，仅支持ijk解码（现在勉强可以看直播了）
- 简陋地实现了直播弹幕播放

### v6.0
> 尝试换用dash格式源

- 视频及剧集强制换用dash格式的web源，不支持hevc编码（如8K）

### v7.0
> 尝试修改页面布局

- 添加播放速度调节功能
- 调整直播分区，添加我的关注
- 直播源换用flv格式的android源

### v8.0
> 继续调整

- 禁用剧集花絮自动跳转到剧集页面
- 增加直播画质切换功能
- 排行榜调整
- 修复换用dash格式源后长视频过期导致的播放卡死
- 增加视频点赞、投币功能：长按点赞一键三连；长按投币同时点赞
- 视频详情页微调
- 分区调整
- 优化视频及剧集播放进度处理：优先使用云端播放进度
- 增加个性化推荐：点击首页“推荐”文字刷新
- 个人投稿页面增加关注功能
- 直播按键微调
- 升级直播源，部分解决bvc-play-url-one错误

### v9.0
> 播放优化

- 尝试修复播放第一个视频音画不同步问题
- 调整解码器选取策略，允许hevc软解，应该能看8K了
- 修复升级直播源后画质低问题
- 增加可修改包名的自定义编译方式
- 增加查看关注用户功能
- 长按记忆播放速度调节状态
- 修复原版uid过长导致的用户搜索失败问题
- 测试性功能——模拟换台：直播时上下键切换频道
- 视频播放列表调整，合集作为备选
- 优化历史记录管理
- 番剧详情页优化
- 视频详情页调整
- 增加播放模式调节功能
- 升级直播弹幕协议
- 支持表情包及图片直播弹幕

### v10.0
> 尝试页面调整

- 分区视频默认页调整为分区热门推荐
- 添加课程类视频支持
- 调整信息显示
- 修复aid和cid过长导致的部分问题
- 长按记忆播放模式调节状态
- 测试性功能——视频过滤：规则可参照示例自定义
- 测试性功能——CC字幕：采用高级弹幕实现
- 测试性功能——弹幕过滤
- 主页推荐接口调整，1.6.6版本的接口坏了时用1.6.4版本的接口
- 测试性功能——自定义CDN
- 测试性功能——视频空降
- 增加“稍后再看”
- 测试性功能——自定义开屏壁纸
- 增加个性化设置

### v11.0 test
> 尝试比较激进的调整

- 测试性功能——检查第三方更新
- 测试性功能——“我的”标签页排序：应用重启后生效

## todo list
- [x] 似乎6月1日后web源只能拿到720P，继续寻找可用源。。。


## 修改
`diff -r mybv bv0`查看相对于原版的改动。
视频源换源请修改`mybv/smali/bl/ql.smali`。
剧集源换源请修改`mybv/smali/bl/qh.smali`。


## 编译
- 环境安装
```bash
sudo apt install apktool signapk openjdk-8-jdk
sudo update-alternatives --set javac /usr/lib/jvm/java-8-openjdk-amd64/bin/javac
```
- 普通编译：`./build.sh`
- 特殊编译：`./build.sh -s 包名`
> PS: 修改包名可能导致程序运行时出现部分错误。